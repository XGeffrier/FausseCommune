<!DOCTYPE html>
<html>
<head>
    <title>Geo Info App</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>
    <style>
        #map {
            position: absolute;
            top: 0;
            left: 0;
            height: 100vh;
            width: 48%;
        }

        #info {
            position: absolute;
            top: 0;
            right: 0;
            padding: 20px;
            width: 48%;
            height: 100vh;
            overflow-y: auto;
        }

        body {
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>
<h1>Geo Info App</h1>
<div id="map"></div>
<div id="info"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin=""></script>
<script>
    var map = L.map('map', {
        minZoom: 6,
        maxBounds: [
            //south west
            [40, -6],
            //north east
            [52, 10]
        ],
    }).setView([46.86584459507945, 2.4942937666232954], 6);

    let marker;

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors',
        maxZoom: 18
    }).addTo(map);

    function onMapClick(e) {
        let lat = e.latlng.lat.toFixed(6);
        let long = e.latlng.lng.toFixed(6);


        if (marker) {
            map.removeLayer(marker); // Remove previous marker
        }
        marker = L.marker([lat, long]).addTo(map); // Add new marker

        document.getElementById('info').innerHTML = 'Chargement...';

        fetch('/get_geo_info', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({lat: lat, long: long})
        }).then((r) => {
            return r.json()
        }).then((o) => {

            let names = o.names

            let innerUl = names.map((value) => `<li>${value}</li>`).join('')

            document.getElementById('info').innerHTML = `<ul>${innerUl}</ul>`
        })
    }

    map.on('click', onMapClick);
</script>
</body>
</html>
